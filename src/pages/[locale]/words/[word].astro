---
import fs from "fs";
import "@fontsource/ma-shan-zheng";
import PageLayout from "@/layouts/PageLayout.astro";
import "@fontsource/twinkle-star";
import Hanzi from "@/components/widget/WritingWords.astro";
import { pinyin } from "pinyin-pro";
import type { MetaData, PinyinWord, WordDetail } from "@/common/types";
import Explanation from "@/components/widget/Explanation.astro";
import { getLang, supportedLang } from "@/customize/lang";
import { getIntlData } from "@/customize/intl";

export async function getStaticPaths() {
    const wordFiles = fs.readdirSync("src/data/words");
    let paths = [];
    for (let lang of supportedLang) {
        for (let word of wordFiles) {
            paths.push({
                params: {
                    locale: lang?.locale,
                    word: word.split(".")[0],
                },
            });
        }
    }
    return paths;
}

const { word, locale } = Astro.params;
const lang = getLang(locale);
const intlData = getIntlData(lang);

const pinyins = pinyin(word, { type: "array" });

let pinyinWords: PinyinWord[] = [];
for (let i = 0; i < word.length; i++) {
    pinyinWords.push({
        word: word[i],
        pinyin: pinyins[i],
    });
}

let content = fs.readFileSync(`src/data/words/${word}.json`);
let wordDetail: WordDetail = JSON.parse(content.toString());

// Todo
const metadata: MetaData = {
    title: `Chinese Words - ${word}`,
    description: "Chinese Words",
    lang: lang,
};
---

<PageLayout metadata={metadata}>
    <main class="max-w-screen-md mx-auto">
        <h1 class="text-4xl text-center text-white">{word}</h1>
        <div class="mb-20">
            <Hanzi pinyinWords={pinyinWords} />
        </div>

        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4 font-serif">
                {intlData.word.information}
            </h2>
        </div>

        <div class="my-10">
            <h2 class="text-2xl py-4 font-serif">
                {intlData.word.explanation}
            </h2>
            <div>
                {
                    wordDetail.explanations.map((explanation, index) => (
                        <Explanation explanation={explanation} index={index} />
                    ))
                }
            </div>
        </div>
        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4 font-serif">
                {intlData.word.writing}
            </h2>
        </div>
        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4 font-serif">
                {intlData.word.relatedList}
            </h2>
        </div>
        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4 font-serif">
                {intlData.word.homophones}
            </h2>
        </div>
    </main>
</PageLayout>
