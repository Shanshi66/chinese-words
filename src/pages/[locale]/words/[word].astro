---
import fs from "fs";
import PageLayout from "@/layouts/PageLayout.astro";
import Hanzi from "@/components/widget/WritingWords.astro";
import { pinyin } from "pinyin-pro";
import type { MetaData, PinyinWord } from "@/common/types";
import Explanation from "@/components/widget/Explanation.astro";
import { getLang, supportedLang } from "@/customize/lang";
import { getIntlData } from "@/customize/intl";
import { loadAllWords, loadWord } from "@/utils/words";
import { allList, getListIntl } from "@/customize/list";

export async function getStaticPaths() {
    const words = loadAllWords()
    let paths = [];
    for (let lang of supportedLang) {
        for (let word of words) {
            paths.push({
                params: {
                    locale: lang?.locale,
                    word: word.word,
                },
            });
        }
    }
    return paths;
}

const { word, locale } = Astro.params;
const lang = getLang(locale);
const intlData = getIntlData(lang);

const pinyins = pinyin(word, { type: "array" });

let pinyinWords: PinyinWord[] = [];
for (let i = 0; i < word.length; i++) {
    pinyinWords.push({
        word: word[i],
        pinyin: pinyins[i],
    });
}

let wordDetail = loadWord(word);

let relatedList = allList.filter((list) =>
    list.tags.some((tag) => wordDetail.tags.includes(tag)),
);

const metadata: MetaData = {
    title: `${word} - Chinese Words`,
    description: `${word} - ${intlData.word.description}`,
    lang: lang,
};
---

<PageLayout metadata={metadata}>
    <div>
        <h1 class="text-4xl text-center text-white">{word}</h1>
        <div class="mb-20">
            <Hanzi pinyinWords={pinyinWords} />
        </div>

        <div class="my-10">
            <h2 class="text-2xl py-4">
                {intlData.word.explanation}
            </h2>
            <div>
                {
                    wordDetail.explanations.map((explanation, index) => (
                        <Explanation explanation={explanation} index={index} />
                    ))
                }
            </div>
        </div>
        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4">
                {intlData.word.writing}
            </h2>
            <p class="mt-2 md:text-xl">Click grid above to animate</p>
        </div>
        <div class="my-10">
            <h2 class="text-2xl border-b-[1px] py-4">
                {intlData.word.relatedList}
            </h2>
            <div class="my-4">
                {
                    relatedList.map((list) => (
                        <a
                            href={`/${lang.locale}/lists/${list.name}`}
                            class="text-blue-700 md:text-xl block my-1"
                        >
                            {getListIntl(list, lang).title}
                        </a>
                    ))
                }
            </div>
        </div>
        <!-- <div class="my-10">
                <h2 class="text-2xl border-b-[1px] py-4">
                    {intlData.word.homophones}
                </h2>
            </div> -->
    </div>
</PageLayout>
